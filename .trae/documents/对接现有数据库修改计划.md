# 对接现有数据库修改计划

## 问题分析
当前代码创建了新的数据库文件，而不是使用现有的 `h:\MVP-TestDrivenDevelopment\ScanViz3D\data\scan_data.db` 文件。

## 数据库结构
通过检查，现有数据库包含一个表 `fan_sweep_data`，具有以下关键字段：
- `ave_point_x`, `ave_point_y`, `ave_point_z` (平均值坐标)
- `max_point_x`, `max_point_y`, `max_point_z` (最大值坐标)
- `min_point_x`, `min_point_y`, `min_point_z` (最小值坐标)
- 共 97316 行数据

## 修改计划

### 1. 修改 `src/data_loader.py`
- 更新 `load_point_cloud` 方法，使用 `fan_sweep_data` 表
- 添加参数选择使用哪种坐标数据（平均值、最大值、最小值）
- 优化查询性能，处理大量数据

### 2. 修改 `tests/test_loader.py`
- 更新测试用例，使用现有的数据库文件
- 添加测试不同坐标类型的加载
- 确保测试不修改原始数据库

### 3. 修改 `demo/demo_data_loader.py`
- 更新演示脚本，使用现有的数据库文件
- 添加对不同坐标类型的演示
- 更新输出结果记录

### 4. 更新 `demo/demo_data_loader.md`
- 记录使用现有数据库的运行结果
- 添加数据库结构说明

### 5. 更新 `protocol/ai_context.md`
- 记录函数签名变更
- 添加关于数据库结构的说明

## 技术要点
- 使用现有的 `fan_sweep_data` 表和正确的列名
- 支持选择不同类型的坐标数据
- 优化查询性能，处理 97316 行数据
- 确保不修改原始数据库文件

## 验证步骤
1. 运行 `pytest tests/test_loader.py -v` 验证测试通过
2. 运行 `python demo/demo_data_loader.py` 验证演示正常
3. 检查 `demo/demo_data_loader.md` 记录的结果

## 预期结果
- 所有测试通过
- 演示脚本能够正确加载和展示现有数据库中的数据
- 代码能够处理大量数据并保持良好的性能